{% extends 'app_manager/base_summary.html' %}
{% load hq_shared_tags %}
{% load i18n %}
{% load xforms_extras %}

{% block js %}{{ block.super }}
    <script src="{% static "app_manager/js/summary/form_summary.js" %}"></script>
{% endblock js %}

{% block content_extra %}
    {% initial_page_data 'lang' lang %}
    {% initial_page_data 'langs' langs %}
    {% initial_page_data 'modules' modules %}
    {% initial_page_data 'VELLUM_TYPES' VELLUM_TYPES %}
    {% registerurl 'form_source' domain app_id '---' %}
    {% registerurl 'view_module' domain app_id '---' %}

    <div class="page-header" style="margin-top: 0;">
        <h3>
          <i class="fa fa-file-text-o"></i>
          {% trans "Form Summary" %}</h1>
        </h3>
        <div class="row">
            <div class="col-xs-9">
                <div class="btn-group" role="group" >
                    <!-- TODO: template binding for these? -->
                    <button type="button" class="btn btn-default"
                            data-bind="click: toggleCalculations, css: { active: showCalculations }">
                            <i class="fa fa-calculator" data-bind="css: { 'hq-icon': showCalculations }"></i>
                        &nbsp;{% trans "Calculations" %}
                    </button>
                    <button type="button" class="btn btn-default"
                            data-bind="click: toggleRelevance, css: { active: showRelevance }">
                            <i class="fa fa-code-fork" data-bind="css: { 'hq-icon': showRelevance }"></i>
                        &nbsp;{% trans "Display" %}
                    </button>
                    <button type="button" class="btn btn-default"
                            data-bind="click: toggleConstraints, css: { active: showConstraints }">
                        <i class="fa fa-ban" data-bind="css: { 'hq-icon': showConstraints }"></i>
                        &nbsp;{% trans "Validation" %}
                    </button>
                    <button type="button" class="btn btn-default"
                            data-bind="click: toggleComments, css: { active: showComments }">
                        <i class="fa fa-quote-left" data-bind="css: { 'hq-icon': showComments }"></i>
                        &nbsp;{% trans "Comments" %}
                    </button>
                    <button type="button" class="btn btn-default"
                            data-bind="click: toggleDefaultValues, css: { active: showDefaultValues }">
                        <i class="fa fa-home" data-bind="css: { 'hq-icon': showDefaultValues }"></i>
                        &nbsp;{% trans "Default Values" %}
                    </button>
                </div>
                <div class="btn-toolbar pull-right" role="toolbar">
                    <a class="btn btn-primary" href="{% url "download_form_summary" domain app_id %}?lang={{ lang }}">
                        <i class="fa fa-download"></i>
                        {% trans "Download" %}
                    </a>
                </div>
             </div>
        </div>
    </div>

    <!-- TODO: errors -->
    <!--div class="alert alert-danger" ng-repeat="form in errors" ng-show="errors">
        <i class="fa fa-exclamation-circle"></i> {% trans "Error in form:" %}
        {% verbatim %}"{{ getFormModuleLabel(form) }}"{% endverbatim %}
        {% trans "in module" %}
        {% verbatim %}"{{ getFormModuleLabel(form.module) }}"
        <a href="{{ form.error.edit_url }}" ng-if="!readOnly">
            <i class="fa fa-pencil"></i>
        </a><br/>
        {{ form.error.details }}
        {% endverbatim %}
    </div-->

    <ul data-bind="foreach: modules">
        <li data-bind="visible: isSelected">
            <h4>
                <!-- TODO: language support, readOnly -->
                <a data-bind="attr: { href: url }">
                    <i data-bind="attr: { 'class': icon }"></i>
                    <span data-bind="text: name"></span>
                </a>
                <span class="text-muted" data-bind="visible: $root.showComments"> &nbsp; <span data-bind="text: short_comment"</span>
            </h4>
            <ul data-bind="foreach: forms">
                <li data-bind="visible: isSelected">
                    <h5>
                        <!-- TODO: language support, readOnly -->
                        <a data-bind="attr: { href: url }">
                            <i data-bind="attr: { 'class': icon }"></i>
                            <span data-bind="text: name"></span>
                        </a>
                        <span class="text-muted" data-bind="visible: $root.showComments"> &nbsp; <span data-bind="text: short_comment"</span>
                    </h5>
                    <ol data-bind="foreach: questions">
                        <li>
                            <i data-bind="attr: { 'class': icon }" title="type"></i>
                            <span data-bind="text: value"></span> <!-- TODO: name vs id, language support -->
                            <span data-bind="visible: required" title="{% trans "This question is required" %}">*</span>
                            <span class="text-muted" data-bind="visible: $root.showComments">
                                &nbsp; <span data-bind="text: comment"></span>
                            </span>
                            <!-- TODO: template binding for these? -->
                            <ul class="fa-ul" data-bind="if: calculate, visible: $root.showCalculations">
                                <li>
                                    <i class="fa-li fa fa-calculator text-muted"></i>
                                    <span data-bind="text: calculate"></span>
                                </li>
                            </ul>
                            <ul class="fa-ul" data-bind="if: relevant, visible: $root.showRelevance">
                                <li>
                                    <i class="fa-li fa fa-code-fork text-muted"></i>
                                    <span data-bind="text: relevant"></span>
                                </li>
                            </ul>
                            <ul class="fa-ul" data-bind="if: constraint, visible: $root.showConstraints">
                                <li>
                                    <i class="fa-li fa fa-ban text-muted"></i>
                                    <span data-bind="text: constraint"></span>
                                </li>
                            </ul>
                            <ul class="fa-ul" data-bind="if: setvalue, visible: $root.showDefaultValues">
                                <li>
                                    <i class="fa-li fa fa-home text-muted"></i>
                                    <span data-bind="text: setvalue"></span>
                                </li>
                            </ul>
                            <ol data-bind="foreach: options">
                                <li>
                                    <!-- TODO: name vs id, language support -->
                                    <span data-bind="text: value"></span>
                                </li>
                            </ol>
                        </li>
                    </ol>
                </li>
            </ul>
        </li>
    </ul>
{% endblock content_extra %}
